
<!DOCTYPE html>
<html>
<h1> slotmachinetest 1.</h1>
<p>
    Sample snare03 wordt 3 herhaald groep zestiende noten.
    Werkt  13 juni 22:12
    2. speelt ritme van 4 tellen 1 = sinaasappel 2 appel 3 peer 4 appel
    3. met gain en normaliseerde sample
    4 volume variatie met gain.gain.value = (accent/10);
    5. volume control naar 100 en transpose weer ingevoerd. sample met reverb gated drum 10ms
    6 BPM 72
</p>
<button onclick="playAll()">Play all</button>
<button onclick="playRitme()">Play ritme</button>
<button onclick="playDrum()">Play drumloop</button>
<script>





    var reelConfig = {
        introRitme: [
            [
                {
                    time: 0,
                    gain: 50,
                    transpose: 8
                }
            ],
            [
                {
                    time: 0,
                    gain: 50,
                    transpose: 8
                }
            ],
            [
                {
                    time: 0,
                    gain: 50,
                    transpose: 8
                }
            ],
            [
                {
                    time: 0,
                    gain: 50,
                    transpose: 8
                }
            ]
        ],
        ritmes: [
            [
            ],
            [
                {
                    time: 0,
                    gain: 100,
                    transpose: 10
                }
            ],
            [
                {
                    time: 0,
                    gain: 100,
                    transpose: 10
                },
                {
                    time: 2,
                    gain: 100,
                    transpose: 10
                }
            ],
            [
                {
                    time: 0,
                    gain: 100,
                    transpose: 10
                },
                {
                    time: 1,
                    gain: 80,
                    transpose: 10
                },
                {
                    time: 2,
                    gain: 85,
                    transpose: 10
                },
                {
                    time: 3,
                    gain: 70,
                    transpose: 10
                }
            ]
        ],
        bpm: 72
    }




    function playAll() {
        startTime = audioContext.currentTime
        play(bufferDrum, 0, 100, 0)
        startRitme()
    }

    function playRitme() {
        startTime = audioContext.currentTime
        startRitme()
    }

    function playDrum() {
        startTime = audioContext.currentTime
        play(bufferDrum, 0, 100, 0)
    }


    function startRitme() {
        play(bufferSnare, 0, 60, 5) // vier tellen vooraf
        play(bufferSnare, 0, 60, 6	)
        play(bufferSnare, 0.83, 60, 4)
        play(bufferSnare, 1.67, 60, 4)

        play(bufferSnare, 2.5, 60, 4)
        play(bufferSnare, 3.33, 100, 12)
        play(bufferSnare, 3.54, 95, 11)
        play(bufferSnare, 3.75, 90, 12)
        play(bufferSnare, 4.17, 100, 11)
        play(bufferSnare, 4.58, 95, 12)
        play(bufferSnare, 5., 100, 12)
        play(bufferSnare, 5.83, 90, 11)
        play(bufferSnare, 6.25, 95, 12)

    }

    var audioContext = new AudioContext()
    var bufferSnare
    var bufferDrum

    function getSample (url, cb) {
        var request = new XMLHttpRequest()
        request.open('GET', url)
        request.responseType = 'arraybuffer'
        request.onload = function () {
            audioContext.decodeAudioData(request.response, cb)
        }
        request.send()
    }

    function play (sound, delay, accent,transpose) {
        var player = audioContext.createBufferSource()
        var gain = audioContext.createGain()
        player.buffer = sound
        player.connect(gain)

        gain.gain.value = (accent/100);
        gain.connect(audioContext.destination);
        player.start(startTime + delay)
        if (transpose !== 0) {
            player.playbackRate.value = Math.pow(2,transpose/12)
        }
    }

    getSample('/Snare04r.mp3', function (_buffer) {
        console.log('geluid geladen')
        bufferSnare = _buffer
    })

    getSample('/Drumloop01.mp3', function (_buffer) {
        console.log('geluid geladen')
        bufferDrum = _buffer
    })



</script>
</html>